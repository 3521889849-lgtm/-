<template>
	<view class="register-page">
		<view class="register-card">
			<view class="register-header">
				<text class="title">客服注册</text>
				<text class="subtitle">仅限客服账号注册，管理员由后台分配</text>
			</view>

			<view class="register-form">
				<!-- 用户名 -->
				<view class="input-group">
					<text class="input-label">账号 (3-32位)</text>
					<view class="input-wrapper">
						<input class="input-field" type="text" placeholder="设置登录名" v-model="form.user_name" />
					</view>
				</view>

				<!-- 真实姓名 -->
				<view class="input-group">
					<text class="input-label">真实姓名</text>
					<view class="input-wrapper">
						<input class="input-field" type="text" placeholder="请输入您的姓名" v-model="form.real_name" />
					</view>
				</view>

				<!-- 密码 -->
				<view class="input-group">
					<text class="input-label">密码 (至少6位)</text>
					<view class="input-wrapper">
						<input class="input-field" type="password" placeholder="设置登录密码" v-model="form.password" />
					</view>
				</view>

				<!-- 手机号 -->
				<view class="input-group">
					<text class="input-label">手机号 (可选)</text>
					<view class="input-wrapper">
						<input class="input-field" type="text" placeholder="请输入手机号" v-model="form.phone" />
					</view>
				</view>

				<view class="register-btn" :class="{ disabled: loading }" @click="handleRegister">
					<text class="btn-text">{{ loading ? '正在提交...' : '注 册' }}</text>
				</view>

				<view class="footer-links">
					<text class="link-text" @click="backToLogin">返回登录</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	import { api } from '../../common/api.js'
	import { getBaseResp } from '../../common/request.js'

	export default {
		data() {
			return {
				form: {
					user_name: '',
					password: '',
					real_name: '',
					phone: ''
				},
				loading: false
			}
		},
		methods: {
			async handleRegister() {
				if (this.loading) return
				
				// 基础校验
				if (!this.form.user_name || this.form.user_name.length < 3) {
					uni.showToast({ title: '账号至少3位', icon: 'none' })
					return
				}
				if (!this.form.real_name) {
					uni.showToast({ title: '请输入姓名', icon: 'none' })
					return
				}
				if (!this.form.password || this.form.password.length < 6) {
					uni.showToast({ title: '密码至少6位', icon: 'none' })
					return
				}

				this.loading = true
				try {
					const res = await api.register(this.form.user_name, this.form.password, this.form.real_name, this.form.phone)
					const base = getBaseResp(res)
					
					if (base.code === 0) {
						uni.showToast({ title: '注册成功，请登录', icon: 'success' })
						setTimeout(() => {
							this.backToLogin()
						}, 1500)
					} else {
						uni.showToast({ title: base.msg || '注册失败', icon: 'none' })
					}
				} catch (e) {
					uni.showToast({ title: '请求失败，请检查网关', icon: 'none' })
				} finally {
					this.loading = false
				}
			},
			backToLogin() {
				uni.redirectTo({ url: '/pages/login/login' })
			}
		}
	}
</script>

<style>
	.register-page {
		width: 100%;
		height: 100vh;
		background: #f5f5f7;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	.register-card {
		width: 400px;
		background: #ffffff;
		border-radius: 12px;
		padding: 40px;
		box-shadow: 0 4px 12px rgba(0,0,0,0.05);
	}
	.register-header {
		margin-bottom: 30px;
		text-align: center;
	}
	.title {
		font-size: 24px;
		font-weight: 600;
		color: #1d1d1f;
		display: block;
	}
	.subtitle {
		font-size: 13px;
		color: #86868b;
		margin-top: 8px;
	}
	.input-group {
		margin-bottom: 20px;
	}
	.input-label {
		font-size: 14px;
		margin-bottom: 8px;
		display: block;
		color: #1d1d1f;
	}
	.input-wrapper {
		background: #f5f5f7;
		border-radius: 8px;
		padding: 0 16px;
		height: 44px;
	}
	.input-field {
		height: 44px;
		font-size: 15px;
		width: 100%;
	}
	.register-btn {
		height: 44px;
		background: #007aff;
		border-radius: 8px;
		display: flex;
		justify-content: center;
		align-items: center;
		margin-top: 10px;
	}
	.btn-text {
		color: #ffffff;
		font-weight: 600;
	}
	.footer-links {
		margin-top: 20px;
		text-align: center;
	}
	.link-text {
		font-size: 14px;
		color: #007aff;
	}
</style>
