<template>
	<view class="login-page">
		<!-- ç™»å½•å¡ç‰‡ -->
		<view class="login-card">
			<!-- Logoå’Œæ ‡é¢˜ -->
			<view class="login-header">
				<image class="logo" src="/static/PixPin_2026-01-13_19-52-32.png"></image>
				<text class="title">å®¢æœç³»ç»Ÿ</text>
				<text class="subtitle">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦å·</text>
			</view>

			<!-- ç™»å½•è¡¨å• -->
			<view class="login-form">
				<!-- ç”¨æˆ·åè¾“å…¥æ¡† -->
				<view class="input-group">
					<text class="input-label">ç”¨æˆ·å</text>
					<view class="input-wrapper">
						<text class="input-icon">ğŸ‘¤</text>
						<input 
							class="input-field" 
							type="text" 
							placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
							v-model="userName"
							@confirm="handleLogin"
						/>
					</view>
				</view>

				<!-- å¯†ç è¾“å…¥æ¡† -->
				<view class="input-group">
					<text class="input-label">å¯†ç </text>
					<view class="input-wrapper">
						<text class="input-icon">ğŸ”’</text>
						<input 
							class="input-field" 
							type="password" 
							placeholder="è¯·è¾“å…¥å¯†ç " 
							v-model="password"
							@confirm="handleLogin"
						/>
					</view>
				</view>

				<!-- ç™»å½•æŒ‰é’® -->
				<view class="login-btn" :class="{ disabled: loading }" @click="handleLogin">
					<text class="btn-text">{{ loading ? 'ç™»å½•ä¸­...' : 'ç™» å½•' }}</text>
				</view>

				<!-- æç¤ºä¿¡æ¯ -->
				<view class="tips">
					<text class="tip-text">é»˜è®¤ç®¡ç†å‘˜è´¦å·: admin / admin123</text>
				</view>
				
				<view class="tips" style="margin-top: 10px;">
					<text class="tip-text" style="color: #667eea; cursor: pointer;" @click="toRegister">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œå®¢æœ</text>
				</view>
			</view>
		</view>

		<!-- ç‰ˆæƒä¿¡æ¯ -->
		<view class="footer">
			<text class="copyright">Â© 2026 å®¢æœç³»ç»Ÿ All Rights Reserved</text>
		</view>
	</view>
</template>

<script>
	import { api } from '../../common/api.js'
	import { getBaseResp } from '../../common/request.js'

	export default {
		data() {
			return {
				userName: '',
				password: '',
				loading: false
			}
		},
		onLoad() {
			// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
			const token = uni.getStorageSync('token')
			if (token) {
				// å·²ç™»å½•ï¼Œè·³è½¬åˆ°é¦–é¡µ
				uni.redirectTo({ url: '/pages/index/index' })
			}
		},
		methods: {
			async handleLogin() {
				// é˜²æ­¢é‡å¤æäº¤
				if (this.loading) return

				// è¡¨å•æ ¡éªŒ
				const userName = this.userName.trim()
				const password = this.password.trim()
				if (!userName) {
					uni.showToast({ title: 'è¯·è¾“å…¥ç”¨æˆ·å', icon: 'none' })
					return
				}
				if (!password) {
					uni.showToast({ title: 'è¯·è¾“å…¥å¯†ç ', icon: 'none' })
					return
				}

				this.loading = true
				try {
					// è°ƒç”¨ç™»å½•æ¥å£
					const res = await api.login(userName, password)
					const base = getBaseResp(res)

					if (base.code === 0 && res.data) {
						// ç™»å½•æˆåŠŸï¼Œä¿å­˜tokenå’Œç”¨æˆ·ä¿¡æ¯
						uni.setStorageSync('token', res.data.token)
						uni.setStorageSync('userInfo', JSON.stringify(res.data.user_info))
						uni.setStorageSync('isLogin', 'true')
						uni.setStorageSync('roleCode', res.data.user_info.role_code)

						uni.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' })
						
						// è·³è½¬åˆ°é¦–é¡µ
						setTimeout(() => {
							uni.redirectTo({ url: '/pages/index/index' })
						}, 500)
					} else {
						// ç™»å½•å¤±è´¥
						uni.showToast({ title: base.msg || 'ç™»å½•å¤±è´¥', icon: 'none' })
					}
				} catch (err) {
					console.error('ç™»å½•å¤±è´¥:', err)
					uni.showToast({ title: 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', icon: 'none' })
				} finally {
					this.loading = false
				}
			},
			toRegister() {
				uni.redirectTo({ url: '/pages/register/register' })
			}
		}
	}
</script>

<style>
	.login-page {
		width: 100%;
		height: 100vh;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
	}

	.login-card {
		width: 420px;
		background-color: #ffffff;
		border-radius: 16px;
		padding: 48px 40px;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
	}

	.login-header {
		display: flex;
		flex-direction: column;
		align-items: center;
		margin-bottom: 40px;
	}

	.logo {
		width: 64px;
		height: 64px;
		margin-bottom: 16px;
	}

	.title {
		font-size: 28px;
		font-weight: 700;
		color: #1d1d1f;
		margin-bottom: 8px;
	}

	.subtitle {
		font-size: 14px;
		color: #86909c;
	}

	.login-form {
		display: flex;
		flex-direction: column;
	}

	.input-group {
		margin-bottom: 24px;
	}

	.input-label {
		font-size: 14px;
		font-weight: 500;
		color: #4e5969;
		margin-bottom: 8px;
	}

	.input-wrapper {
		display: flex;
		flex-direction: row;
		align-items: center;
		background-color: #f7f8fa;
		border-radius: 8px;
		padding: 0 16px;
		height: 48px;
		border: 1px solid #e5e6eb;
		transition: border-color 0.2s;
	}

	.input-wrapper:focus-within {
		border-color: #667eea;
		background-color: #ffffff;
	}

	.input-icon {
		font-size: 18px;
		margin-right: 12px;
	}

	.input-field {
		flex: 1;
		height: 48px;
		font-size: 15px;
		color: #1d1d1f;
		background-color: transparent;
		border: none;
	}

	.login-btn {
		height: 48px;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		border-radius: 8px;
		display: flex;
		justify-content: center;
		align-items: center;
		margin-top: 8px;
		cursor: pointer;
		transition: opacity 0.2s, transform 0.2s;
	}

	.login-btn:hover {
		opacity: 0.9;
		transform: translateY(-1px);
	}

	.login-btn:active {
		transform: translateY(0);
	}

	.login-btn.disabled {
		opacity: 0.6;
		cursor: not-allowed;
	}

	.btn-text {
		font-size: 16px;
		font-weight: 600;
		color: #ffffff;
		letter-spacing: 2px;
	}

	.tips {
		margin-top: 24px;
		display: flex;
		justify-content: center;
	}

	.tip-text {
		font-size: 12px;
		color: #c9cdd4;
	}

	.footer {
		position: fixed;
		bottom: 32px;
	}

	.copyright {
		font-size: 12px;
		color: rgba(255, 255, 255, 0.6);
	}
</style>
