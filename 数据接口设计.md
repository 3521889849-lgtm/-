4.1 通用规范
•接口前缀：/api/v1/customer-service
•请求/响应格式：JSON
•状态码规则：200-成功，400-参数错误，401-未授权，403-权限不足，404-资源不存在，500-服务器错误
•分页参数：pageNum（默认1）、pageSize（默认20），响应包含total（总条数）、pages（总页数）
4.2 排班管理接口
4.2.1 创建班次配置
•接口地址：/shift/config
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "shiftName": "早班",
  "startTime": "08:00:00",
  "endTime": "16:30:00",
  "minStaff": 2,
  "isHoliday": 0
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "创建成功",
  "data": {
    "shiftId": 1,
    "shiftName": "早班"
  }
}
4.2.2 客服排班分配
•接口地址：/schedule/assign
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "scheduleDate": "2025-08-16",
  "shiftId": 1,
  "csIds": ["KF001", "KF002"] // 批量分配，单个传数组长度1
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "排班成功",
  "data": {
    "successCsIds": ["KF001", "KF002"],
    "failCsIds": []
  }
}
4.2.3 请假/调班申请
•接口地址：/leave-transfer/apply
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "applyType": 0, // 0-请假，1-调班
  "targetDate": "2025-08-17",
  "shiftId": 1,
  "targetCsId": "KF003", // 调班时必填
  "reason": "身体不适"
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "申请提交成功",
  "data": {
    "applyId": 1001
  }
}
4.2.4 查询排班表
•接口地址：/schedule/list
•请求方法：GET
•请求头：Authorization: Bearer {token}
•请求参数（Query）：
￮scheduleDate: 日期（可选，如2025-08-16）
￮deptId: 部门ID（可选）
￮teamId: 班组ID（可选）
￮shiftId: 班次ID（可选）
•响应参数：
JSON
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 3,
    "pages": 1,
    "list": [
      {
        "scheduleId": 101,
        "csId": "KF001",
        "csName": "张某某",
        "shiftId": 1,
        "shiftName": "早班",
        "scheduleDate": "2025-08-16",
        "status": 0,
        "deptId": "DEPT001",
        "teamId": "TEAM001",
        "isAbnormal": false // 是否人数不足异常
      }
    ]
  }
}
4.3 会话管理接口
4.3.1 接收实时会话（WebSocket）
•连接地址：ws://{domain}/api/v1/customer-service/conv/connect?csId={csId}&token={token}
•消息格式（服务端推送用户会话请求）：
JSON
{
  "type": "new_conv",
  "data": {
    "convId": "conv-xxx-xxx",
    "userId": "user-xxx",
    "userNickname": "测试用户",
    "source": "网页",
    "historyConvIds": ["conv-xxx-xxx2"] // 历史会话ID
  }
}
4.3.2 会话转接
•接口地址：/conv/transfer
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "convId": "conv-xxx-xxx",
  "targetCsId": "KF002", // 目标客服ID
  "skillTag": "退款处理", // 技能标签（可选，用于筛选）
  "remark": "用户咨询退款流程，需专业客服处理" // 会话上下文备注
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "转接成功",
  "data": {
    "targetCsName": "李某某"
  }
}
4.3.3 快捷回复配置
•接口地址：/quick-reply/save
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "replyType": 0, // 0-咨询类，1-投诉类，2-建议类，3-通用类
  "replyContent": "您好，票务查询可通过【我的订单】-【订单详情】查看",
  "isPublic": 1 // 0-个人，1-公共
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "保存成功",
  "data": {
    "replyId": 101
  }
}
4.4 记录存储与检索接口
4.4.1 会话记录查询
•接口地址：/conv/record/list
•请求方法：GET
•请求头：Authorization: Bearer {token}
•请求参数（Query）：
￮userId: 用户ID（可选）
￮csId: 客服ID（可选）
￮startTime: 开始时间（可选，如2025-08-01 00:00:00）
￮endTime: 结束时间（可选，如2025-08-16 23:59:59）
￮keyword: 关键词（可选）
￮convId: 会话ID（可选）
￮msgType: 消息类型（可选，0-4）
•响应参数：
JSON
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 10,
    "pages": 1,
    "list": [
      {
        "convId": "conv-xxx-xxx",
        "userId": "user-xxx",
        "userNickname": "测试用户",
        "csId": "KF001",
        "csName": "张某某",
        "source": "网页",
        "startTime": "2025-08-16 10:00:00",
        "endTime": "2025-08-16 10:10:00",
        "msgType": 0,
        "msgCount": 5 // 消息条数
      }
    ]
  }
}
4.4.2 会话记录导出
•接口地址：/conv/record/export
•请求方法：GET
•请求头：Authorization: Bearer {token}
•请求参数（Query）：
￮同“会话记录查询”参数
￮format: 导出格式（excel/pdf，默认excel）
•响应参数：
JSON
{
  "code": 200,
  "msg": "导出任务已创建",
  "data": {
    "taskId": "export-xxx-xxx",
    "downloadUrl": "/api/v1/customer-service/conv/record/download?taskId={taskId}" // 1分钟后可下载
  }
}
4.5 消息归类管理接口
4.5.1 消息自动分类（内部调用）
•接口地址：/msg/classify/auto
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "convId": "conv-xxx-xxx",
  "msgContent": "我的订单出票失败，申请退款"
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "分类成功",
  "data": {
    "msgType": 1, // 1-投诉类
    "confidence": 0.95 // 置信度
  }
}
4.5.2 人工调整消息分类
•接口地址：/msg/classify/manual
•请求方法：POST
•请求头：Authorization: Bearer {token}
•请求参数：
JSON
{
  "convId": "conv-xxx-xxx",
  "msgType": 1 // 调整后的分类
}
•响应参数：
JSON
{
  "code": 200,
  "msg": "调整成功",
  "data": {}
}
4.5.3 归类统计查询
•接口地址：/msg/classify/stat
•请求方法：GET
•请求头：Authorization: Bearer {token}
•请求参数（Query）：
￮startTime: 开始时间（如2025-08-01）
￮endTime: 结束时间（如2025-08-31）
￮statType: 统计类型（day-按日，month-按月）
•响应参数：
JSON
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "statList": [
      {
        "date": "2025-08-16",
        "consultCount": 100, // 咨询类
        "complainCount": 20, // 投诉类
        "suggestCount": 10, // 建议类
        "otherCount": 5 // 其他类
      }
    ],
    "totalCount": 135,
    "ratio": { // 占比
      "consultRatio": 74.07,
      "complainRatio": 14.81,
      "suggestRatio": 7.41,
      "otherRatio": 3.70
    }
  }
}