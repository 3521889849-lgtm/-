# 票务系统 API 接口文档

本文档基于代码库中的 API 定义生成，涵盖了商家入驻、资质管理、审核流程、合同通知、商家后台及系统支撑等核心模块的接口说明。

## 1. 商家入驻模块 (Merchant Application)

### 1.1 表单校验
*   **接口描述**: 校验商家入驻申请表单数据的合法性。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/application/validate`
*   **请求参数**:
    *   `name` (string): 商家名称
    *   `phone` (string): 联系电话
    *   `business_license` (string): 营业执照号
    *   `ticket_type` (int32): 票务类型
*   **响应结果**:
    *   `code` (int): 状态码
    *   `msg` (string): 消息
    *   `data` (object): 校验结果

### 1.2 暂存草稿
*   **接口描述**: 暂存商家入驻申请草稿。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/application/draft`
*   **请求参数**:
    *   `application_no` (string, optional): 申请编号（修改时传入）
    *   `name` (string): 商家名称
    *   `contact_name` (string): 联系人
    *   `phone` (string): 联系电话
    *   `address` (string): 地址
    *   `ticket_type` (int32): 票务类型
    *   `business_license` (string): 营业执照
    *   `business_scope` (string): 经营范围
    *   `remark` (string, optional): 备注
*   **响应结果**:
    *   `code` (int): 状态码
    *   `msg` (string): 消息
    *   `application_no` (string): 生成/更新的申请编号

### 1.3 提交申请
*   **接口描述**: 正式提交商家入驻申请。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/application/submit`
*   **请求参数**:
    *   `application_no` (string): 申请编号
*   **响应结果**:
    *   `code` (int): 状态码
    *   `msg` (string): 消息
    *   `data` (object): 提交结果

### 1.4 查询详情
*   **接口描述**: 查询商家入驻申请详情。
*   **请求方式**: `GET`
*   **请求路径**: `/merchant/application/detail`
*   **请求参数**:
    *   `application_no` (string): 申请编号
*   **响应结果**:
    *   `code` (int): 状态码
    *   `msg` (string): 消息
    *   `detail` (object): 申请详情数据

## 2. 资质文件模块 (Qualification)

### 2.1 资质文件上传
*   **接口描述**: 上传商家资质文件（支持多类型文件，5MB内≤2s上传完成）。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/qualification/upload`
*   **请求参数**: (JSON Body)
    *   `file_name` (string): 文件名
    *   `file_content` (string): 文件内容（Base64）
    *   `qualification_type` (int32): 资质类型
*   **响应结果**: 上传结果

### 2.2 资质文件自动校验
*   **接口描述**: 校验资质文件完整性、有效期及经营范围。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/qualification/validate`
*   **请求参数**:
    *   `file_path` (string): 文件路径
    *   `qualification_type` (int32): 资质类型
*   **响应结果**: 校验结果

### 2.3 资质文件查看
*   **接口描述**: 查看资质文件详情（带权限控制）。
*   **请求方式**: `GET`
*   **请求路径**: `/merchant/qualification/detail`
*   **请求参数**:
    *   `qualification_id` (string): 资质ID
    *   `user_id` (string): 用户ID
    *   `user_type` (string): 用户类型
*   **响应结果**: 资质详情

### 2.4 资质文件修改/补充
*   **接口描述**: 修改或补充资质文件。
*   **请求方式**: `POST`
*   **请求路径**: `/merchant/qualification/update`
*   **请求参数**: 更新信息
*   **响应结果**: 更新状态

### 2.5 获取资质列表
*   **接口描述**: 获取申请的所有资质列表。
*   **请求方式**: `GET`
*   **请求路径**: `/merchant/qualification/list`
*   **请求参数**:
    *   `apply_id` (string): 申请ID
*   **响应结果**: 资质列表

### 2.6 获取下载链接
*   **接口描述**: 获取资质文件加密存储的访问链接。
*   **请求方式**: `GET`
*   **请求路径**: `/merchant/qualification/download`
*   **请求参数**:
    *   `qualification_id` (string): 资质ID
    *   `user_id` (string): 用户ID
    *   `user_type` (string): 用户类型
*   **响应结果**: 下载链接

## 3. 审核流程模块 (Audit)

### 3.1 审核配置
*   **创建配置**: `POST /audit/config/create` - 创建新的审核流程配置
*   **更新配置**: `PUT /audit/config/update` - 更新审核流程配置
*   **获取配置**: `GET /audit/config/detail` - 获取指定票务类型的审核配置
*   **配置权限**: `POST /audit/config/permission` - 配置审核节点的权限规则

### 3.2 自动审核
*   **触发自动审核**: `POST /audit/auto/trigger` - 手动触发自动审核流程
*   **校验文件**: `POST /audit/auto/validate` - 单独调用自动审核规则校验文件
*   **获取规则**: `GET /audit/auto/rules` - 获取当前生效的审核规则

### 3.3 人工审核
*   **提交结果**: `POST /audit/manual/submit` - 审核员提交人工审核结果
*   **待审核列表**: `GET /audit/manual/pending` - 获取审核员的待办任务列表
*   **审核详情**: `GET /audit/manual/detail` - 获取单次审核任务的详细信息

### 3.4 流程控制
*   **流转流程**: `POST /audit/flow/transfer` - 强制流转审核节点
*   **重新触发**: `POST /audit/flow/retrigger` - 重新触发审核流程
*   **流程状态**: `GET /audit/flow/status` - 查询当前审核流程状态

### 3.5 进度与历史
*   **查询进度**: `GET /audit/progress/query` - 查询申请的审核进度
*   **批量查询**: `POST /audit/progress/batch` - 批量查询审核进度
*   **查询历史**: `GET /audit/history/query` - 查询审核历史记录
*   **导出记录**: `POST /audit/history/export` - 导出审核记录（Excel/CSV）

## 4. 合同与通知模块 (Contract & Notification)

### 4.1 电子合同
*   **生成合同**: `POST /contract/generate`
    *   参数: `application_no`, `contract_template_id`, `contract_name`, `custom_terms`
*   **签署合同**: `POST /contract/sign`
    *   参数: `contract_no`, `signer_id`, `signer_name`, `signature_data`, `signer_type`

### 4.2 通知服务
*   **发送通知**: `POST /notification/send`
    *   参数: `application_no`, `notification_type`, `notify_channels`, `notify_content`, `receiver`, `template_id`
*   **查询状态**: `GET /notification/status`
    *   参数: `application_no`, `receiver`, `notification_type`, `start_time`, `end_time`
*   **异常重试**: `POST /notification/retry`
    *   参数: `notification_ids`, `max_retry_count`

## 5. 商家后台模块 (Merchant Backend)

### 5.1 店铺管理
*   **店铺配置**: `POST /merchant/backend/shop/config` - 设置店铺基础信息
*   **获取配置**: `GET /merchant/backend/shop/config` - 获取店铺配置信息

### 5.2 类目管理
*   **申请类目**: `POST /merchant/backend/category/apply` - 申请开通新的票务类目
*   **获取列表**: `GET /merchant/backend/category/list` - 获取已开通或申请中的类目列表

### 5.3 权限与统计
*   **分配权限**: `POST /merchant/backend/role/assign` - 分配用户角色和权限
*   **用户角色**: `GET /merchant/backend/role/list` - 获取商家下的用户角色列表
*   **数据统计**: `GET /merchant/backend/stats` - 获取商家入驻及经营数据统计

## 6. 系统支撑模块 (System Support)

### 6.1 缓存管理
*   **设置缓存**: `POST /system/cache/set`
*   **获取缓存**: `GET /system/cache/get`
*   **删除缓存**: `DELETE /system/cache/delete`
*   **批量设置**: `POST /system/cache/batch/set`
*   **批量获取**: `POST /system/cache/batch/get`
*   **缓存统计**: `GET /system/cache/stats`

### 6.2 消息队列 (MQ)
*   **发布消息**: `POST /system/mq/publish`
*   **创建队列**: `POST /system/mq/queue/create`
*   **队列信息**: `GET /system/mq/queue/info`

### 6.3 监控指标 (Metrics)
*   **记录指标**: `POST /system/metric/record`
*   **计数器递增**: `POST /system/metric/counter`
*   **查询指标**: `POST /system/metric/query`

### 6.4 审计日志
*   **记录日志**: `POST /system/audit/log`
*   **查询日志**: `GET /system/audit/query`

### 6.5 数据库与健康检查
*   **执行查询**: `POST /system/db/query`
*   **索引建议**: `GET /system/db/index/suggestions`
*   **分析查询**: `POST /system/db/analyze`
*   **慢查询**: `GET /system/db/slow`
*   **健康检查**: `GET /system/health/check`
