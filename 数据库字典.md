# 酒店住宿管理后台系统 - 数据库字典

> 本文档基于 `common/model/hotel_admin` 包中的数据模型生成  
> 生成时间：2025-01-16  
> 数据库类型：MySQL

---

## 目录

1. [核心业务表](#核心业务表)
2. [系统管理表](#系统管理表)
3. [权限管理表](#权限管理表)
4. [财务管理表](#财务管理表)
5. [会员管理表](#会员管理表)
6. [配置字典表](#配置字典表)
7. [关联关系表](#关联关系表)

---

## 核心业务表

### 1. hotel_branch - 酒店分店表

**表说明：** 存储酒店分店的基本信息，支持多分店管理，每个分店可以有多个房源、订单和财务数据。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 分店ID |
| hotel_name | VARCHAR(100) | ❌ | ✅ | - | idx_hotel_name | 酒店名称 |
| branch_code | VARCHAR(50) | ❌ | ✅ | - | uk_branch_code | 分店编码（全局唯一） |
| address | VARCHAR(255) | ❌ | ✅ | - | - | 分店地址 |
| contact | VARCHAR(50) | ❌ | ✅ | - | - | 联系人 |
| contact_phone | VARCHAR(20) | ❌ | ✅ | - | - | 联系电话 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| created_by | BIGINT UNSIGNED | ❌ | ✅ | - | - | 创建人ID |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对多：房源信息（room_info.branch_id）
- 一对多：订单主表（hotel_order_main.branch_id）
- 一对多：财务流水（financial_flow.branch_id）
- 一对多：用户账号（user_account.branch_id）

---

### 2. room_info - 房源信息表

**表说明：** 存储酒店的所有房间信息，包括房间号、房型、价格、状态等，作为订单的关联主体。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 房源ID |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| room_type_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_type_id | 房型ID（外键） |
| room_no | VARCHAR(20) | ❌ | ✅ | - | idx_room_no | 房间号 |
| room_name | VARCHAR(100) | ❌ | ✅ | - | - | 房间名称 |
| market_price | DECIMAL(10,2) | ❌ | ✅ | - | - | 门市价 |
| calendar_price | DECIMAL(10,2) | ❌ | ✅ | - | - | 日历价 |
| room_count | TINYINT UNSIGNED | ❌ | ✅ | 1 | - | 房间数量 |
| area | DECIMAL(5,2) | ❌ | ❌ | NULL | - | 面积（平方米） |
| bed_spec | VARCHAR(50) | ❌ | ✅ | - | - | 床型规格 |
| has_breakfast | BOOLEAN | ❌ | ✅ | false | - | 是否含早餐（0/1） |
| has_toiletries | BOOLEAN | ❌ | ✅ | false | - | 是否提供洗漱用品（0/1） |
| cancellation_policy_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_cancellation_policy_id | 退订政策ID（外键） |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用，MAINTENANCE-维修 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 修改时间 |
| created_by | BIGINT UNSIGNED | ❌ | ✅ | - | - | 创建人ID |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：所属分店（hotel_branch.id）
- 多对一：房型字典（room_type_dict.id）
- 多对一：退订政策（cancellation_policy.id）
- 一对多：房间设施关联（room_facility_relation.room_id）
- 一对多：房间图片（room_image.room_id）
- 一对多：房间状态明细（room_status_detail.room_id）
- 一对多：订单主表（hotel_order_main.room_id）

---

### 3. hotel_order_main - 订单主表

**表说明：** 记录客人的订房信息，作为整个订单流程的核心数据，关联房源、客人、支付、财务等多个业务模块。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 订单ID |
| order_no | VARCHAR(32) | ❌ | ✅ | - | uk_order_no | 订单号（全局唯一） |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| guest_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_guest_id | 客人ID（外键） |
| room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_id | 房源ID（外键） |
| room_type_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_type_id | 房型ID（外键） |
| guest_source | VARCHAR(50) | ❌ | ✅ | - | idx_guest_source | 客人来源（散客/携程/途游/艺龙等） |
| check_in_time | DATETIME | ❌ | ✅ | - | idx_check_in_time | 入住时间 |
| check_out_time | DATETIME | ❌ | ✅ | - | idx_check_out_time | 离店时间 |
| reserve_time | DATETIME | ❌ | ✅ | - | - | 预定时间 |
| order_amount | DECIMAL(10,2) | ❌ | ✅ | - | - | 订单金额 |
| deposit_received | DECIMAL(10,2) | ❌ | ✅ | 0.00 | - | 已收押金 |
| outstanding_amount | DECIMAL(10,2) | ❌ | ✅ | 0.00 | - | 欠补费用 |
| order_status | VARCHAR(30) | ❌ | ✅ | 'RESERVED' | idx_order_status | 订单状态（已预定/已入住/已退房/已失效） |
| pay_type | VARCHAR(20) | ❌ | ✅ | - | idx_pay_type | 支付方式（现金/支付宝/微信/银联等） |
| cancellation_policy_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_cancellation_policy_id | 退订政策ID（外键） |
| penalty_amount | DECIMAL(10,2) | ❌ | ✅ | 0.00 | - | 违约金金额 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | idx_create_time | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 修改时间 |
| operator_id | BIGINT UNSIGNED | ❌ | ✅ | - | - | 操作人ID |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：所属分店（hotel_branch.id）
- 多对一：客人信息（guest_info.id）
- 多对一：房源信息（room_info.id）
- 多对一：房型字典（room_type_dict.id）
- 多对一：退订政策（cancellation_policy.id）
- 一对一：订单扩展信息（order_extension.order_id）
- 一对多：财务流水（financial_flow.order_id）
- 一对多：会员积分记录（member_points_record.order_id）

---

### 4. guest_info - 客人信息表

**表说明：** 存储客人的实名制登记信息，满足公安部门的住宿登记要求，支持在住客人查询和历史入住记录。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 客人ID |
| name | VARCHAR(50) | ❌ | ✅ | - | idx_name | 姓名 |
| gender | VARCHAR(10) | ❌ | ❌ | NULL | - | 性别 |
| ethnicity | VARCHAR(30) | ❌ | ❌ | NULL | - | 民族 |
| province | VARCHAR(30) | ❌ | ❌ | NULL | - | 省份 |
| address | VARCHAR(255) | ❌ | ❌ | NULL | - | 地址 |
| id_type | VARCHAR(20) | ❌ | ✅ | - | - | 证件类型（身份证等） |
| id_number | VARCHAR(50) | ❌ | ✅ | - | idx_id_number | 证件号（加密存储） |
| phone | VARCHAR(20) | ❌ | ✅ | - | idx_phone | 手机号（加密存储） |
| check_in_time | DATETIME | ❌ | ❌ | NULL | idx_check_in_time | 入住时间 |
| check_out_time | DATETIME | ❌ | ❌ | NULL | idx_check_out_time | 离店时间 |
| room_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_room_id | 房源ID（外键） |
| order_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_order_id | 订单ID（外键） |
| register_time | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 登记时间 |
| register_by | BIGINT UNSIGNED | ❌ | ✅ | - | - | 登记人ID |
| is_member | BOOLEAN | ❌ | ✅ | false | - | 是否会员（0/1） |
| member_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_member_id | 会员ID（外键） |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：当前所住房间（room_info.id）
- 多对一：当前关联订单（hotel_order_main.id）
- 多对一：会员信息（member.id）
- 一对多：历史订单（hotel_order_main.guest_id）
- 一对多：财务流水（financial_flow.guest_id）

---

## 系统管理表

### 5. user_account - 用户账号表

**表说明：** 存储系统用户的账号信息，支持账号管理和权限控制，通过角色控制用户的操作权限。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 账号ID |
| username | VARCHAR(50) | ❌ | ✅ | - | uk_username | 用户名（全局唯一） |
| password | VARCHAR(255) | ❌ | ✅ | - | - | 密码（加密存储） |
| real_name | VARCHAR(50) | ❌ | ✅ | - | - | 姓名 |
| contact_phone | VARCHAR(20) | ❌ | ✅ | - | idx_contact_phone | 联系电话 |
| role_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_role_id | 角色ID（外键） |
| branch_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_branch_id | 分店ID（外键，管理员可为空） |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 账号状态（启用/停用） |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| last_login_at | DATETIME | ❌ | ❌ | NULL | idx_last_login_at | 最后登录时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：角色信息（role.id）
- 多对一：所属分店（hotel_branch.id）
- 一对多：操作日志（operation_log.operator_id）

---

### 6. role - 角色表

**表说明：** 支撑基于角色的权限管理（RBAC），通过角色统一管理权限，避免为每个用户单独分配权限。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 角色ID |
| role_name | VARCHAR(50) | ❌ | ✅ | - | uk_role_name | 角色名称（全局唯一） |
| description | VARCHAR(255) | ❌ | ❌ | NULL | - | 角色描述 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对多：用户账号（user_account.role_id）
- 一对多：角色权限关联（role_permission_relation.role_id）

---

### 7. permission - 权限表

**表说明：** 存储系统的所有权限定义，支持树形结构，父权限可以包含多个子权限。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 权限ID |
| permission_name | VARCHAR(100) | ❌ | ✅ | - | - | 权限名称 |
| permission_code | VARCHAR(100) | ❌ | ✅ | - | uk_permission_code | 权限代码（全局唯一） |
| permission_type | VARCHAR(20) | ❌ | ✅ | - | idx_permission_type | 权限类型（菜单/按钮/API） |
| parent_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_parent_id | 父权限ID |
| resource_path | VARCHAR(255) | ❌ | ❌ | NULL | - | 资源路径 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| sort_order | INT | ❌ | ✅ | 0 | - | 排序序号 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对多：子权限（permission.parent_id）
- 一对多：角色权限关联（role_permission_relation.permission_id）

---

### 8. role_permission_relation - 角色权限关联表

**表说明：** 角色与权限的关联关系表，实现多对多关系，一个角色可以拥有多个权限，一个权限可以分配给多个角色。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 关联ID |
| role_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_role_id | 角色ID（外键） |
| permission_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_permission_id | 权限ID（外键） |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：角色信息（role.id）
- 多对一：权限信息（permission.id）

---

### 9. operation_log - 操作日志表

**表说明：** 记录系统用户的所有操作日志，用于审计追溯、责任认定和行为分析。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 日志ID |
| operator_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_operator_id | 操作人ID（外键） |
| operation_type | VARCHAR(50) | ❌ | ✅ | - | idx_operation_type | 操作类型（创建/更新/删除/查询等） |
| operation_module | VARCHAR(50) | ❌ | ✅ | - | idx_operation_module | 操作模块（订单/会员/财务等） |
| operation_desc | VARCHAR(255) | ❌ | ✅ | - | - | 操作描述 |
| request_method | VARCHAR(10) | ❌ | ❌ | NULL | - | 请求方法（GET/POST/PUT/DELETE） |
| request_path | VARCHAR(255) | ❌ | ❌ | NULL | - | 请求路径 |
| request_params | JSON | ❌ | ❌ | NULL | - | 请求参数（JSON格式） |
| response_code | INT | ❌ | ❌ | NULL | - | 响应状态码 |
| operation_time | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | idx_operation_time | 操作时间 |
| ip_address | VARCHAR(50) | ❌ | ❌ | NULL | - | IP地址 |
| user_agent | VARCHAR(255) | ❌ | ❌ | NULL | - | 用户代理 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |

**关联关系：**
- 多对一：操作人信息（user_account.id）

---

## 财务管理表

### 10. financial_flow - 收支流水表

**表说明：** 记录所有财务收支明细（收入和支出），支撑财务流水查询和统计分析。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 流水ID |
| order_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_order_id | 订单ID（外键） |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| room_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_room_id | 房源ID（外键） |
| guest_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_guest_id | 客人ID（外键） |
| flow_type | VARCHAR(20) | ❌ | ✅ | - | idx_flow_type | 收支类型（收入/支出） |
| flow_item | VARCHAR(50) | ❌ | ✅ | - | idx_flow_item | 收支项目（房费/押金/违约金等） |
| pay_type | VARCHAR(20) | ❌ | ✅ | - | idx_pay_type | 支付方式 |
| amount | DECIMAL(10,2) | ❌ | ✅ | - | - | 金额 |
| occur_time | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | idx_occur_time | 发生时间 |
| operator_id | BIGINT UNSIGNED | ❌ | ✅ | - | - | 操作人ID |
| remark | VARCHAR(500) | ❌ | ❌ | NULL | - | 备注 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：订单信息（hotel_order_main.id）
- 多对一：分店信息（hotel_branch.id）
- 多对一：房源信息（room_info.id）
- 多对一：客人信息（guest_info.id）

---

## 会员管理表

### 11. member - 会员表

**表说明：** 存储会员的基础信息和等级，支持会员等级体系和积分管理。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 会员ID |
| guest_id | BIGINT UNSIGNED | ❌ | ✅ | - | uk_guest_id | 客人ID（外键，全局唯一） |
| member_level | VARCHAR(30) | ❌ | ✅ | 'NORMAL' | idx_member_level | 会员等级（普通/黄金/钻石等） |
| points_balance | BIGINT UNSIGNED | ❌ | ✅ | 0 | - | 积分余额 |
| register_time | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 注册时间 |
| last_check_in_time | DATETIME | ❌ | ❌ | NULL | idx_last_check_in_time | 最后入住时间 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 会员状态（启用/冻结） |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对一：客人信息（guest_info.id）
- 一对多：积分流水记录（member_points_record.member_id）

---

### 12. member_points_record - 会员积分记录表

**表说明：** 记录会员的积分流水，包括积分获取和使用明细。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 记录ID |
| member_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_member_id | 会员ID（外键） |
| order_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | idx_order_id | 订单ID（外键） |
| change_type | VARCHAR(20) | ❌ | ✅ | - | idx_change_type | 变动类型（获得/消耗） |
| points_value | INT | ❌ | ✅ | - | - | 积分变动值 |
| points_balance | BIGINT UNSIGNED | ❌ | ✅ | - | - | 变动后余额 |
| change_reason | VARCHAR(255) | ❌ | ✅ | - | - | 变动原因 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | idx_created_at | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：会员信息（member.id）
- 多对一：订单信息（hotel_order_main.id）

---

### 13. member_rights - 会员权益表

**表说明：** 定义不同会员等级的权益配置，包括折扣、服务等权益。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 权益ID |
| member_level | VARCHAR(30) | ❌ | ✅ | - | idx_member_level | 会员等级 |
| right_name | VARCHAR(100) | ❌ | ✅ | - | - | 权益名称 |
| right_desc | VARCHAR(255) | ❌ | ❌ | NULL | - | 权益描述 |
| discount_rate | DECIMAL(5,2) | ❌ | ❌ | NULL | - | 折扣率 |
| effective_time | DATETIME | ❌ | ❌ | NULL | - | 生效时间 |
| expire_time | DATETIME | ❌ | ❌ | NULL | - | 失效时间 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

---

### 14. blacklist - 黑名单表

**表说明：** 记录被列入黑名单的客人信息，禁止或限制其预订和入住。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 黑名单ID |
| id_number | VARCHAR(50) | ❌ | ❌ | NULL | idx_id_number | 证件号（加密存储） |
| phone | VARCHAR(20) | ❌ | ❌ | NULL | idx_phone | 手机号（加密存储） |
| name | VARCHAR(50) | ❌ | ❌ | NULL | - | 姓名 |
| reason | VARCHAR(255) | ❌ | ✅ | - | - | 列入原因 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

---

## 配置字典表

### 15. room_type_dict - 房型字典表

**表说明：** 定义房间类型字典，如标准间、豪华套房等，为房源提供类型分类。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 房型ID |
| room_type_name | VARCHAR(50) | ❌ | ✅ | - | uk_room_type_name | 房型名称（全局唯一） |
| description | VARCHAR(255) | ❌ | ❌ | NULL | - | 房型描述 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对多：房源信息（room_info.room_type_id）

---

### 16. facility_dict - 设施字典表

**表说明：** 定义酒店设施字典，如WiFi、空调、电视等，用于房源设施配置。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 设施ID |
| facility_name | VARCHAR(100) | ❌ | ✅ | - | - | 设施名称 |
| description | VARCHAR(255) | ❌ | ❌ | NULL | - | 设施描述 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对多：房间设施关联（room_facility_relation.facility_id）

---

### 17. cancellation_policy - 退订政策表

**表说明：** 定义退订政策规则，包括退订规则描述和违约金比例。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 政策ID |
| policy_name | VARCHAR(100) | ❌ | ✅ | - | - | 政策名称 |
| rule_description | TEXT | ❌ | ✅ | - | - | 规则描述 |
| penalty_ratio | DECIMAL(5,2) | ❌ | ✅ | - | - | 违约金比例 |
| room_type_id | BIGINT UNSIGNED | ❌ | ❌ | NULL | - | 适用房型ID（外键） |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：适用房型（room_type_dict.id）
- 一对多：房源信息（room_info.cancellation_policy_id）
- 一对多：订单主表（hotel_order_main.cancellation_policy_id）

---

### 18. channel_config - 渠道配置表

**表说明：** 配置外部渠道（如OTA平台）的同步参数，包括API地址和同步规则。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 配置ID |
| channel_name | VARCHAR(100) | ❌ | ✅ | - | uk_channel_name | 渠道名称（全局唯一） |
| channel_code | VARCHAR(50) | ❌ | ✅ | - | uk_channel_code | 渠道代码（全局唯一） |
| api_url | VARCHAR(255) | ❌ | ❌ | NULL | - | API地址 |
| api_key | VARCHAR(255) | ❌ | ❌ | NULL | - | API密钥（加密存储） |
| sync_rule | JSON | ❌ | ❌ | NULL | - | 同步规则（JSON格式） |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

---

### 19. system_config - 系统配置表

**表说明：** 存储系统的配置参数，支持按分类管理不同类型的配置。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 配置ID |
| config_key | VARCHAR(100) | ❌ | ✅ | - | uk_config_key | 配置键（全局唯一） |
| config_value | TEXT | ❌ | ✅ | - | - | 配置值 |
| config_category | VARCHAR(50) | ❌ | ❌ | NULL | idx_config_category | 配置分类 |
| description | VARCHAR(255) | ❌ | ❌ | NULL | - | 配置描述 |
| status | VARCHAR(20) | ❌ | ✅ | 'ACTIVE' | idx_status | 状态：ACTIVE-启用，INACTIVE-停用 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

---

## 关联关系表

### 20. room_facility_relation - 房间设施关联表

**表说明：** 房源与设施的关联关系表，一个房间可以配置多个设施。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 关联ID |
| room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_id | 房源ID（外键） |
| facility_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_facility_id | 设施ID（外键） |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：房源信息（room_info.id）
- 多对一：设施字典（facility_dict.id）

---

### 21. room_image - 房间图片表

**表说明：** 存储房源的展示图片，支持多张图片上传和排序。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 图片ID |
| room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_id | 房源ID（外键） |
| image_url | VARCHAR(255) | ❌ | ✅ | - | - | 图片URL |
| image_size | VARCHAR(20) | ❌ | ❌ | NULL | - | 图片尺寸 |
| image_format | VARCHAR(10) | ❌ | ❌ | NULL | - | 图片格式 |
| sort_order | TINYINT UNSIGNED | ❌ | ✅ | 0 | - | 排序序号 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：房源信息（room_info.id）

---

### 22. room_status_detail - 房间状态明细表

**表说明：** 记录房间的状态明细信息，支持日历化房态管理。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 明细ID |
| room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_room_id | 房源ID（外键） |
| date | DATE | ❌ | ✅ | - | idx_date | 日期 |
| room_status | VARCHAR(20) | ❌ | ✅ | - | idx_room_status | 房态状态（空净房/入住房/维修房等） |
| remaining_count | TINYINT UNSIGNED | ❌ | ✅ | 0 | - | 当日剩余数量 |
| checked_in_count | TINYINT UNSIGNED | ❌ | ✅ | 0 | - | 已入住人数 |
| check_out_pending_count | TINYINT UNSIGNED | ❌ | ✅ | 0 | - | 预退房人数 |
| reserved_pending_count | TINYINT UNSIGNED | ❌ | ✅ | 0 | - | 预定待入住人数 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：房源信息（room_info.id）

---

### 23. related_room_binding - 关联房绑定表

**表说明：** 记录房源之间的关联绑定关系，如套房关联主卧和次卧。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 绑定ID |
| main_room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_main_room_id | 主房源ID（外键） |
| related_room_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_related_room_id | 关联房源ID（外键） |
| binding_desc | VARCHAR(255) | ❌ | ❌ | NULL | - | 绑定描述 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：主房源信息（room_info.id）
- 多对一：关联房源信息（room_info.id）

---

### 24. order_extension - 订单扩展信息表

**表说明：** 存储订单的扩展信息，如特殊要求、备注等。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 扩展ID |
| order_id | BIGINT UNSIGNED | ❌ | ✅ | - | uk_order_id | 订单ID（外键，全局唯一） |
| special_requirements | TEXT | ❌ | ❌ | NULL | - | 特殊要求 |
| remark | TEXT | ❌ | ❌ | NULL | - | 备注 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 一对一：订单主表（hotel_order_main.id）

---

### 25. channel_sync_log - 渠道同步日志表

**表说明：** 记录房态数据同步到外部渠道的日志，用于追踪同步状态和错误。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 日志ID |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| channel_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_channel_id | 渠道ID（外键） |
| sync_type | VARCHAR(50) | ❌ | ✅ | - | idx_sync_type | 同步类型 |
| sync_status | VARCHAR(20) | ❌ | ✅ | - | idx_sync_status | 同步状态（成功/失败） |
| sync_data | JSON | ❌ | ❌ | NULL | - | 同步数据（JSON格式） |
| error_message | TEXT | ❌ | ❌ | NULL | - | 错误信息 |
| sync_time | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | idx_sync_time | 同步时间 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |

**关联关系：**
- 多对一：分店信息（hotel_branch.id）
- 多对一：渠道配置（channel_config.id）

---

### 26. sales_statistics - 销售统计表

**表说明：** 存储销售统计数据，支持按日期、分店等维度统计。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 统计ID |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| stat_date | DATE | ❌ | ✅ | - | idx_stat_date | 统计日期 |
| total_orders | INT UNSIGNED | ❌ | ✅ | 0 | - | 总订单数 |
| total_revenue | DECIMAL(12,2) | ❌ | ✅ | 0.00 | - | 总收入 |
| occupancy_rate | DECIMAL(5,2) | ❌ | ✅ | 0.00 | - | 入住率 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| updated_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP ON UPDATE | - | 更新时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：分店信息（hotel_branch.id）

---

### 27. shift_change_record - 交接班记录表

**表说明：** 记录分店的交接班信息，包括交接时间、交接人、交接内容等。

| 字段名 | 数据类型 | 是否主键 | 是否必填 | 默认值 | 索引 | 说明 |
|--------|---------|---------|---------|--------|------|------|
| id | BIGINT UNSIGNED | ✅ | ✅ | 自增 | PRIMARY | 记录ID |
| branch_id | BIGINT UNSIGNED | ❌ | ✅ | - | idx_branch_id | 分店ID（外键） |
| shift_date | DATE | ❌ | ✅ | - | idx_shift_date | 交接日期 |
| handover_user_id | BIGINT UNSIGNED | ❌ | ✅ | - | - | 交班人ID |
| takeover_user_id | BIGINT UNSIGNED | ❌ | ✅ | - | - | 接班人ID |
| handover_content | TEXT | ❌ | ❌ | NULL | - | 交接内容 |
| created_at | DATETIME | ❌ | ✅ | CURRENT_TIMESTAMP | - | 创建时间 |
| deleted_at | DATETIME | ❌ | ❌ | NULL | idx | 软删除时间 |

**关联关系：**
- 多对一：分店信息（hotel_branch.id）

---

## 数据字典说明

### 数据类型说明

- **BIGINT UNSIGNED**: 无符号大整数（0 到 18446744073709551615）
- **INT UNSIGNED**: 无符号整数（0 到 4294967295）
- **TINYINT UNSIGNED**: 无符号小整数（0 到 255）
- **VARCHAR(n)**: 可变长度字符串，最大长度 n
- **TEXT**: 长文本字符串
- **DECIMAL(m,n)**: 精确小数，m 为总位数，n 为小数位数
- **DATETIME**: 日期时间类型
- **DATE**: 日期类型
- **BOOLEAN**: 布尔类型（0/1）
- **JSON**: JSON 格式数据

### 索引说明

- **PRIMARY**: 主键索引
- **uk_**: 唯一索引（Unique Index）
- **idx_**: 普通索引（Index）

### 状态字段说明

**通用状态值：**
- `ACTIVE`: 启用
- `INACTIVE`: 停用

**订单状态值：**
- `RESERVED`: 已预订
- `CHECKED_IN`: 已入住
- `CHECKED_OUT`: 已退房
- `CANCELLED`: 已取消
- `EXPIRED`: 已失效

**房态状态值：**
- `空净房`: 房间空闲且干净
- `入住房`: 房间已入住
- `维修房`: 房间维修中
- `锁定房`: 房间被锁定
- `空账房`: 房间空闲但未清洁
- `预定房`: 房间已预定

**收支类型：**
- `INCOME`: 收入
- `EXPENSE`: 支出

**会员等级：**
- `NORMAL`: 普通会员
- `SILVER`: 银卡会员
- `GOLD`: 金卡会员
- `PLATINUM`: 白金会员
- `DIAMOND`: 钻石会员

### 加密字段说明

以下字段涉及敏感信息，存储时需加密：

- **guest_info.id_number**: 证件号（AES 加密）
- **guest_info.phone**: 手机号（AES 加密）
- **blacklist.id_number**: 证件号（AES 加密）
- **blacklist.phone**: 手机号（AES 加密）
- **user_account.password**: 密码（bcrypt 加密）
- **channel_config.api_key**: API 密钥（加密存储）

### 软删除说明

所有表都支持软删除机制，通过 `deleted_at` 字段标记删除状态：
- `NULL`: 未删除
- `非NULL`: 已删除（值为删除时间）

软删除的好处：
- 数据可恢复
- 保证历史数据完整性
- 满足审计要求

---

## 表关系图

```
hotel_branch (分店)
    ├── room_info (房源)
    │   ├── room_facility_relation (房间设施关联)
    │   ├── room_image (房间图片)
    │   ├── room_status_detail (房间状态明细)
    │   └── related_room_binding (关联房绑定)
    ├── hotel_order_main (订单)
    │   └── order_extension (订单扩展)
    ├── guest_info (客人)
    │   └── member (会员)
    │       └── member_points_record (积分记录)
    ├── financial_flow (财务流水)
    ├── user_account (用户账号)
    │   └── operation_log (操作日志)
    ├── sales_statistics (销售统计)
    └── shift_change_record (交接班记录)

role (角色)
    ├── user_account (用户账号)
    └── role_permission_relation (角色权限关联)
        └── permission (权限)

room_type_dict (房型字典)
    └── room_info (房源)

facility_dict (设施字典)
    └── room_facility_relation (房间设施关联)

cancellation_policy (退订政策)
    ├── room_info (房源)
    └── hotel_order_main (订单)

channel_config (渠道配置)
    └── channel_sync_log (渠道同步日志)
```

---

## 更新日志

| 日期 | 版本 | 说明 |
|------|------|------|
| 2025-01-16 | v1.0 | 初始版本，包含所有27个数据表的完整字段说明 |

---

**文档维护：** 本文档基于代码中的模型定义自动生成，如模型有变更请及时更新文档。